name: Release

on:
    push:
        tags:
            - "v*" # Triggers on tags like v1.0.0, v1.2.3

permissions:
    contents: write # Needed to create releases

jobs:
    release:
        name: Create Release
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0 # Full history for changelog

            - name: Set up Go
              uses: actions/setup-go@v5
              with:
                  go-version: "1.21"

            - name: Run tests
              run: go test ./...

            - name: Build binaries
              run: |
                  # Windows AMD64
                  GOOS=windows GOARCH=amd64 go build -ldflags "-X main.Version=${{ github.ref_name }}" -o officeforge-windows-amd64.exe ./cmd/officeforge

                  # Windows ARM64
                  GOOS=windows GOARCH=arm64 go build -ldflags "-X main.Version=${{ github.ref_name }}" -o officeforge-windows-arm64.exe ./cmd/officeforge

            - name: Generate checksums
              run: |
                  sha256sum officeforge-* > checksums.txt
                  cat checksums.txt

            - name: Create Release
              uses: softprops/action-gh-release@v1
              with:
                  files: |
                      officeforge-windows-amd64.exe
                      officeforge-windows-arm64.exe
                      checksums.txt
                  body: |
                      ## Installation

                      Download the appropriate binary for your system.

                      ### Via Go Install
                      ```bash
                      go install github.com/siliconcatalyst/officeforge/cmd/officeforge@${{ github.ref_name }}
                      ```

                      ### Manual Installation
                      1. Download the binary for your Windows architecture
                      2. Extract and move to a directory in your PATH or run directly

                      ### Verify Installation
                      ```bash
                      officeforge-windows-amd64.exe version
                      ```
                  draft: false
                  prerelease: false
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
